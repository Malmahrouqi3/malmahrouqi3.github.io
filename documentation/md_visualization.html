<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SY496B9L99"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-SY496B9L99');
</script>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MFC: Flow visualization</title>
<meta name=”keywords” content="exascale, fluid dynamics, cfd, computational fluid dynamics, compressible, hpc, bryngelson, colonius, subgrid, multiphase, frontier, summit, el capitan, aurora, amd gpu, gpu, nvidia"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
// This file is set as MATHJAX_CODEFILE in the Doxyfile. It configures how
// MathJax renders expressions in Markdown so that it is consistent with GitHub.
MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath:  [ ['$',  '$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true,
      ignoreClass: "line" // Ignore code blocks: https://web.archive.org/web/20120430100225/http://www.mathjax.org/docs/1.1/options/tex2jax.html
    },
    "HTML-CSS": {
      fonts: ["TeX"]
    }
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link rel="shortcut icon" href="icon.ico" type="image/x-icon" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="icon.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MFC
   </div>
   <div id="projectbrief">High-fidelity multiphase flow simulation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_visualization.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Flow visualization</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md165"></a></p>
<p>A post-processed database in Silo-HDF5 format can be visualized and analyzed using Paraview and VisIt. After the post-processing of simulation data (see section <a class="el" href="md_running.html">Running</a>), a directory named <code>silo_hdf5</code> contains a silo-HDF5 database. Here, <code>silo_hdf5/</code> includes a directory named <code>root/</code> that contains index files for flow field data at each saved time step.</p>
<h2><a class="anchor" id="autotoc_md166"></a>
Visualizing with Paraview</h2>
<p>Paraview is an open-source interactive parallel visualization and graphical analysis tool for viewing scientific data. Paraview 5.11.0 has been confirmed to work with the MFC databases for some parallel environments. Nevertheless, the installation and configuration of Paraview can be environment-dependent and are left to the user.</p>
<p>The user can launch Paraview and open the index files under <code>/silo_hdf5/root</code>. Once the database is loaded, flow field variables contained in the database can be added to the render view. Further information on Paraview can be found in its <a href="https://docs.paraview.org/en/latest/">documentation</a>. The figure below shows the iso-contour of the liquid void fraction (<code>alpha1</code>) in the database generated by the example case <code>3D_sphbubcollapse</code>.</p>
<p><img src="../res/paraview.png" alt="" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md167"></a>
Visualizing data in cylindrical coordinates</h2>
<p>Visualizing data in cylindrical coordinates requires a coordinate transformation of the raw data in the database file. In Paraview, this coordinate transformation can be accomplished with the following steps:</p>
<ol type="1">
<li>Apply a <code>clean to grid</code> filter to the raw data</li>
<li>Apply a <code>calculator</code> filter to the cleaned data<ul>
<li>Set the calculator <code>attribute type</code> to point data</li>
<li>Check the box for <code>Coordinate Results</code></li>
<li>Enter the formula <code>coordsX*cos(coordsY)*iHat + coordsX*sin(coordsY)*jHat + coordsZ*kHat</code></li>
<li>click apply</li>
</ul>
</li>
</ol>
<p>These steps will transform the raw data into cylindrical coordinates. For many cases, this step will require resizing the render view window.</p>
<h1><a class="anchor" id="autotoc_md168"></a>
Visualizing with VisIt</h1>
<p>VisIt is an alternative open-source interactive parallel visualization and graphical analysis tool for viewing scientific data. Versions of VisIt after 2.6.0 have been confirmed to work with the MFC databases for some parallel environments. Nevertheless, installation and configuration of VisIt can be environment-dependent and are left to the user. Further remarks on parallel flow visualization, analysis, and processing of the MFC database using VisIt can also be found in <a class="el" href="md_references.html">Coralic (2015)</a> and <a class="el" href="md_references.html">Meng (2016)</a>.</p>
<p>The user can launch VisIt and open the index files under <code>/silo_hdf5/root</code>. Once the database is loaded, flow field variables contained in the database can be added to the plot. The figure below shows the iso-contour of the liquid void fraction (<code>alpha1</code>) in the database generated by the example case <code>3D_sphbubcollapse</code>. For analysis and processing of the database using VisIt's capability, the user is encouraged to address <a href="https://wci.llnl.gov/simulation/computer-codes/visit/manuals">VisIt user manual</a>.</p>
<p><img src="../res/visit.png" alt="" class="inline"/></p>
<p><em>Iso-contour of the liquid void fraction (<code>alpha1</code>) in the database generated by example case <code>3D_sphbubcollapse</code></em></p>
<h1><a class="anchor" id="autotoc_md169"></a>
Serial data output</h1>
<p>If <code>parallel_io = 'F'</code>, MFC will output the conservative variables to a directory <code>D/</code>. If multiple cores are used ($\mathtt{ppn &gt; 1}$), then a separate file is created for each core. If only one coordinate dimension (<code>n = 0</code> and <code>p = 0</code>) exists, the primitive variables will also be written to <code>D/</code>. The file names correspond to the variables associated with each equation solved by MFC. They are written at every <code>t_step_save</code> time step. The conservative variables are</p>
<p>$$ {(\rho \alpha)}_{1}, \dots, (\rho\alpha)_{N_c}, \rho u_{1}, \dots, \rho u_{N_d}, E, \alpha_1, \dots, \alpha_{N_c} $$</p>
<p>and the primitive variables are</p>
<p>$$ {(\rho \alpha)}_1, \dots, (\rho\alpha)_{N_c}, u_1, \dots, u_{N_d}, p, \alpha_1, \dots, \alpha_{N_c} $$</p>
<p>where $N_c$ are the number of components <code>num_fluids</code> and $N_d$ is the number of spatial dimensions. There are exceptions: if <code>model_eqns = 3</code>, then the six-equation model appends these variables with the internal energies of each component. If there are sub-grid bubbles <code>bubbles = T</code>, then the bubble variables are also written. These depend on the bubble dynamics model used. If <code>polytropic = 'T'</code>, then the conservative variables are appended by</p>
<p>$$ n_b R_1, n_b {\dot R}_1, \dots, n_b R_{N_b}, n_b {\dot R}_{N_b} $$</p>
<p>where $n_B$ is the bubble number density, and $N_b$ is the number of bubble sizes (see the matching variable in the input file, <code>Nb</code>). The primitive bubble variables do not include $n_B$:</p>
<p>$$ R_1, {\dot R}_1, \dots, R_{N_b}, {\dot R}_{N_b} $$</p>
<h1><a class="anchor" id="autotoc_md170"></a>
Remote Visualization on PACE Phoenix</h1>
<h2><a class="anchor" id="autotoc_md171"></a>
Step 1: Setting up your Environment</h2>
<p>Begin by downloading the <code>.zip</code> file <a href="https://www.dropbox.com/scl/fi/bdk8702oas8zqu0mk24vx/paceParaview.zip?rlkey=bov1s6lra0z7dhhrh6etniucx&amp;st=2m9xvls4&amp;dl=0">here</a>. This file contains two things:</p>
<ul>
<li>A bash script to automate the job submission process and provide instructions for remote connection</li>
<li>A prebuilt Paraview 5.11 binary</li>
</ul>
<p>Place the file <code>paceParview.zip</code> in your scratch direction on Phoenix and unzip it using <code>unzip paceParaview.zip</code>. Enter the new directory <code>paceParaview</code> and run <code>tar -xvf ParaView-5.11.0-egl-MPI-Linux-Python3.9-x86_64.tar.gz</code> to decompress the compiled binary. Now that you have the binary on Phoenix, you must download Paraview 5.11 on your local machine. Paraview binaries can be downloaded <a href="https://www.paraview.org/download/">here</a>. Select <code>v5.11</code> from the version drop-down bar and install a <code>5.11.0</code> version of Paraview.</p>
<h2><a class="anchor" id="autotoc_md172"></a>
Step 2: Customizing the script</h2>
<p>While all of the bash script's options could be passed as command-line arguments, hardcoding certain unlikely-to-change options saves time. The following is a list of required and suggested updates to make to <code>pace-paraview-server</code>.</p>
<ul>
<li>(Optional) Update line 4 to customize the job name that will show up in the scheduler</li>
<li>(Required) Update line 6 to point towards the location of your Paraview bin directory</li>
<li>(Optional) Update line 51 to reflect the default account you'll use to run Paraview jobs</li>
<li>(Optional) Update line 52 to reflect the default wall time requested for your job</li>
</ul>
<h2><a class="anchor" id="autotoc_md173"></a>
Step 3: Running pace-paraview-server</h2>
<p>Before running <code>pace-paraview-server</code> for the first time, you must update its permissions by running <code>chmod u+x pace-paraview-server</code> in your command line. Once this has been done, you can run <code>./pace-paraview-server</code> with the following options:</p>
<ul>
<li><code>--account</code> specifies the charge account for the job. If you updated line 51 of <code>pace-paraview-server</code> to reflect a default account, this option is optional; otherwise, it is required.</li>
<li><code>--nodes</code> specifies the number of nodes to request (default 1)</li>
<li><code>--mem</code> specifies the memory per node to request (default is to request all memory)</li>
<li><code>--gres</code> specifies the GPU resources to request. These instructions have only been verified to work with <code>--gres gpu:V100:2</code>.</li>
<li><code>--time</code> specifies the time limit for your job. This is optional and defaults to whatever is set on line 52 of <code>pace-paraview-server</code>.</li>
</ul>
<p>Once you run <code>./pace-paraview-server &lt;options&gt;</code>, it'll take a bit to start up. In the meantime, you'll see the below message:</p>
<div class="fragment"><div class="line">Submitted batch job &lt;job #&gt;</div>
<div class="line">Waiting for ParaView server to start. This may take several minutes  ...</div>
</div><!-- fragment --><p>When initializing is done, you should see a dialogue with some recommended next steps, numbered 1-4. Below is a slightly altered version of that dialogue:</p>
<p>1) Create the appropriate port forwarding for your local ParaView session to connect with.</p><ul>
<li>On your local machine, run the following from a terminal: <code>nodeIdentifier</code> is the remote node running the ParaView server process (given in the output of the batch script), and <code>paceSystemIdentifier</code> is the name of the PACE system (however, this is configured with your <code>.ssh/config</code>).</li>
<li>This terminal session must not be killed for your ParaView session as it maintains the port forwarding.<ul>
<li><code>ssh -L 8722:&lt;nodeIdentifier&gt;:53723 &lt;paceSystemIdentifier&gt;</code></li>
</ul>
</li>
</ul>
<p>2) Once you have <code>Paraview5.11.0</code> on your machine, select <code>File -&gt; Connect..</code> to open the remote connection dialogue box.</p><ul>
<li>Double-click the existing configuration if you've already set up the PACE connection.</li>
<li>Click <code>Add Server</code> If you have not set up the PACE connection. This will create a new dialogue box where you can specify a configuration name and set the <code>Port</code> to <code>8722</code>. Once this is done, click <code>configure</code> and then <code>save</code> on the next dialogue box. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
